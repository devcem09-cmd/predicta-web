<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predicta PRO | Analiz Masasƒ±</title>
    <!-- Tailwind CSS (Hƒ±zlƒ± Stil) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js (Reaktivite) -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'JetBrains Mono', monospace; background-color: #0f172a; color: #e2e8f0; }
        .card-gradient { background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%); }
        .prob-high { color: #4ade80; font-weight: bold; } /* Ye≈üil */
        .prob-med { color: #facc15; } /* Sarƒ± */
        .prob-low { color: #f87171; } /* Kƒ±rmƒ±zƒ± */
        
        /* Scrollbar Gizleme */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="antialiased min-h-screen pb-10">

    <!-- Ana Uygulama Konteyneri (Alpine.js Data) -->
    <div x-data="appData()" x-init="fetchMatches()" class="container mx-auto px-4 max-w-4xl">
        
        <!-- Header -->
        <header class="py-6 flex justify-between items-center border-b border-slate-800 mb-6 sticky top-0 z-50 bg-[#0f172a]/90 backdrop-blur">
            <div>
                <h1 class="text-2xl font-bold text-yellow-500 tracking-tighter">PREDICTA<span class="text-white">PRO</span></h1>
                <p class="text-xs text-slate-400">Yapay Zeka Destekli Bahis Analitiƒüi</p>
            </div>
            <div class="text-right">
                <div class="text-xs text-slate-500">Sƒ∞STEM DURUMU</div>
                <div class="text-green-500 text-sm font-bold flex items-center justify-end gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> ONLINE
                </div>
            </div>
        </header>

        <!-- Filtre Paneli -->
        <div class="bg-slate-800 p-4 rounded-xl mb-6 flex flex-wrap gap-4 items-center shadow-lg">
            <div class="flex-1">
                <label class="text-xs text-slate-400 block mb-1">SIRALAMA</label>
                <select x-model="filters.sortBy" @change="fetchMatches()" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-sm focus:border-yellow-500 outline-none transition">
                    <option value="date">‚è∞ Tarih (√ñnce Yakƒ±n)</option>
                    <option value="prob_home">üè† Ev Sahibi G√ºven</option>
                    <option value="prob_over">‚öΩ 2.5 √úST G√ºven</option>
                </select>
            </div>
            <div class="flex-1">
                <label class="text-xs text-slate-400 block mb-1">G√úVEN Fƒ∞LTRESƒ∞</label>
                <select x-model="filters.minProb" @change="fetchMatches()" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-sm focus:border-yellow-500 outline-none transition">
                    <option value="0">T√ºm Ma√ßlar</option>
                    <option value="50">%50+ ƒ∞htimal</option>
                    <option value="60">%60+ ƒ∞htimal</option>
                    <option value="70">üî• %70+ BANKO</option>
                </select>
            </div>
            <button @click="fetchMatches()" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-6 rounded transition h-[42px] mt-auto">
                YENƒ∞LE
            </button>
        </div>

        <!-- Ma√ß Listesi -->
        <div class="space-y-4">
            <template x-if="loading">
                <div class="text-center py-10 text-slate-500 animate-pulse">Veriler Analiz Ediliyor...</div>
            </template>

            <template x-for="match in matches" :key="match.id">
                <div class="card-gradient rounded-xl border border-slate-800 overflow-hidden shadow-md hover:border-slate-600 transition duration-300">
                    
                    <!-- √úst Kƒ±sƒ±m: Lig ve Tarih -->
                    <div class="bg-slate-900/50 p-3 flex justify-between items-center text-xs text-slate-400 font-bold border-b border-slate-800">
                        <span x-text="match.league" class="uppercase tracking-wide"></span>
                        <span x-text="match.date"></span>
                    </div>

                    <!-- Takƒ±mlar ve Skor Tahmini -->
                    <div class="p-5 flex justify-between items-center relative">
                        <div class="w-1/3 text-left">
                            <div x-text="match.home" class="text-lg font-bold text-white leading-tight"></div>
                            <div class="text-xs text-slate-500 mt-1">Ev Sahibi</div>
                        </div>
                        
                        <div class="text-center w-1/3">
                            <div class="text-xs bg-slate-700 text-slate-300 px-2 py-1 rounded mb-2 inline-block">VS</div>
                        </div>

                        <div class="w-1/3 text-right">
                            <div x-text="match.away" class="text-lg font-bold text-white leading-tight"></div>
                            <div class="text-xs text-slate-500 mt-1">Deplasman</div>
                        </div>
                    </div>

                    <!-- Oranlar Grid -->
                    <div class="grid grid-cols-6 gap-px bg-slate-800 border-t border-slate-800 text-center">
                        <!-- MS 1 -->
                        <div class="bg-slate-900 p-2 flex flex-col justify-center" :class="{'bg-yellow-500/10 border-b-2 border-yellow-500': isBest(match, '1')}">
                            <span class="text-[10px] text-slate-400">MS 1</span>
                            <span class="text-sm font-bold" x-text="match.odds.ms1"></span>
                            <span class="text-[10px]" :class="getColor(match.probs['1'])" x-text="'%' + match.probs['1']"></span>
                        </div>
                        <!-- MS X -->
                        <div class="bg-slate-900 p-2 flex flex-col justify-center" :class="{'bg-yellow-500/10 border-b-2 border-yellow-500': isBest(match, 'X')}">
                            <span class="text-[10px] text-slate-400">MS X</span>
                            <span class="text-sm font-bold" x-text="match.odds.msx"></span>
                            <span class="text-[10px]" :class="getColor(match.probs['X'])" x-text="'%' + match.probs['X']"></span>
                        </div>
                        <!-- MS 2 -->
                        <div class="bg-slate-900 p-2 flex flex-col justify-center" :class="{'bg-yellow-500/10 border-b-2 border-yellow-500': isBest(match, '2')}">
                            <span class="text-[10px] text-slate-400">MS 2</span>
                            <span class="text-sm font-bold" x-text="match.odds.ms2"></span>
                            <span class="text-[10px]" :class="getColor(match.probs['2'])" x-text="'%' + match.probs['2']"></span>
                        </div>
                        <!-- KG VAR -->
                        <div class="bg-slate-900 p-2 flex flex-col justify-center" :class="{'bg-yellow-500/10 border-b-2 border-yellow-500': isBestKG(match, 'btts')}">
                            <span class="text-[10px] text-slate-400">KG VAR</span>
                            <span class="text-sm font-bold" x-text="match.odds.kgvar"></span>
                            <span class="text-[10px]" :class="getColor(match.probs.btts)" x-text="'%' + match.probs.btts"></span>
                        </div>
                         <!-- 2.5 √úST -->
                         <div class="bg-slate-900 p-2 flex flex-col justify-center" :class="{'bg-yellow-500/10 border-b-2 border-yellow-500': isBestOver(match, 'over')}">
                            <span class="text-[10px] text-slate-400">2.5 √úST</span>
                            <span class="text-sm font-bold" x-text="match.odds.ust"></span>
                            <span class="text-[10px]" :class="getColor(match.probs.over)" x-text="'%' + match.probs.over"></span>
                        </div>
                        <!-- 2.5 ALT -->
                        <div class="bg-slate-900 p-2 flex flex-col justify-center">
                            <span class="text-[10px] text-slate-400">2.5 ALT</span>
                            <span class="text-sm font-bold" x-text="match.odds.alt"></span>
                            <span class="text-[10px] text-slate-500" x-text="'%' + (100 - match.probs.over).toFixed(1)"></span>
                        </div>
                    </div>
                </div>
            </template>
        </div>

    </div>

    <script>
        function appData() {
            return {
                matches: [],
                loading: false,
                filters: {
                    minProb: 0,
                    sortBy: 'date'
                },
                async fetchMatches() {
                    this.loading = true;
                    try {
                        const params = new URLSearchParams(this.filters).toString();
                        const res = await fetch(`/api/matches?${params}`);
                        this.matches = await res.json();
                    } catch (e) {
                        console.error("Hata:", e);
                    } finally {
                        this.loading = false;
                    }
                },
                getColor(prob) {
                    if (prob >= 65) return 'prob-high';
                    if (prob >= 50) return 'prob-med';
                    return 'prob-low';
                },
                isBest(match, type) {
                    const p = match.probs;
                    const max = Math.max(p['1'], p['X'], p['2']);
                    return p[type] === max && p[type] > 45; // Sadece %45 √ºst√ºyse vurgula
                },
                isBestOver(match) {
                    return match.probs.over > 55;
                },
                isBestKG(match) {
                    return match.probs.btts > 55;
                }
            }
        }
    </script>
</body>
</html>
